#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp
#:import Window kivy.core.window.Window

# =======================
# Global Theme Constants
# =======================

#:set PRIMARY_COLOR (0.415, 0.352, 0.803, 1)
#:set SECONDARY_COLOR (0.15, 0.15, 0.15, 1)
#:set BACKGROUND_COLOR (0.96, 0.97, 0.98, 1)
#:set TEXT_COLOR (0, 0, 0, 1)
#:set SUBTEXT_COLOR (0.4, 0.4, 0.4, 1)

#:set CARD_RADIUS [20]
#:set BUTTON_HEIGHT dp(50)
#:set INPUT_HEIGHT dp(50)
#:set CARD_MAX_WIDTH dp(900)

# ======================
# Screen Manager Root
# ======================

ScreenManager:
    WelcomePage:
    PasswordAnalyzer:
    OrganizationPolicyChecker:
    PersonalInfoPage:

<PrimaryButton@Button>:
    background_normal: ""
    background_color: 0,0,0,0
    size_hint_y: None
    height: BUTTON_HEIGHT
    font_size: sp(18)
    color: 1,1,1,1

    canvas.before:
        Color:
            rgba: PRIMARY_COLOR
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: CARD_RADIUS

<SecondaryButton@Button>:
    background_normal: ""
    background_color: 0,0,0,0
    size_hint_y: None
    height: BUTTON_HEIGHT
    font_size: sp(18) 
    color: 1,1,1,1

    canvas.before:
        Color:
            rgba: SECONDARY_COLOR
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: CARD_RADIUS

<TitleLabel@Label>:
    font_size: sp(32)
    bold: True
    color: TEXT_COLOR
    size_hint_y: None
    height: self.texture_size[1] + dp(10)
    halign: "center"
    text_size: self.width, None

<SubtitleLabel@Label>:
    font_size: sp(18)
    color: SUBTEXT_COLOR
    size_hint_x: 1
    size_hint_y: None
    height: self.texture_size[1]
    halign: "center"
    text_size: self.width, None

<UserText@TextInput>:
    size_hint_y: None
    height: INPUT_HEIGHT
    multiline: False
    background_normal: ""
    background_active: ""
    background_color: 0.93, 0.93, 0.95, 1
    foreground_color: TEXT_COLOR
    padding: dp(10)

<FooterLabel@Label>:
    font_size: "14sp"
    font_name: "assets/Montserrat-Regular.ttf"
    size_hint_y: None
    height: self.texture_size[1] + 10
    color: SECONDARY_COLOR
    halign: "center"

<CardLayout@BoxLayout>:
    orientation: "vertical"
    padding: dp(25)
    spacing: dp(20)

    size_hint_x: None
    width: min(Window.width * 0.9, CARD_MAX_WIDTH)
    size_hint_y: None
    height: self.minimum_height
    pos_hint: {"center_x": 0.5}

    canvas.before:
        Color:
            rgba: 0,0,0,0.12
        RoundedRectangle:
            pos: self.x, self.y - dp(6)
            size: self.width + dp(6), self.height + dp(6)
            radius: CARD_RADIUS

        Color:
            rgba: 1,1,1,1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: CARD_RADIUS

<WelcomePage>:

    name: "Welcome Page"
    canvas.before:
        Color:
            rgba: BACKGROUND_COLOR
        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:
        orientation: "vertical"
        padding: dp(40)
        spacing: dp(40)

        Widget:
            size_hint_y: 1
            height: dp(10)
            
        CardLayout:
            size_hint_y: None
            height: self.minimum_height
            
            TitleLabel:
                text: "Password Strength Checker"

            SubtitleLabel:
                text: "Check your password strength and analyze your organization's policy."
                
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: dp(70)
                spacing: dp(10)
                padding: [0, dp(10)]
                pos_hint: {"center_x": 0.5, "center_y": 0.5}
                valign: "middle"
                halign: "center"

                Widget:
                    size_hint_x: 1

                PrimaryButton:
                    text: "Check My Password"
                    size_hint_x: None
                    width: dp(250)
                    pos_hint: {"center_x": 0.5}
                    on_release: app.root.current = "Password Analyzer"

                SecondaryButton:
                    text: "Policy Analyzer"
                    size_hint_x: None
                    width: dp(250)
                    pos_hint: {"center_x": 0.5}
                    on_release: app.root.current = "Policy Analyzer"

                Widget:
                    size_hint_x: 1  

        Widget: 
        FooterLabel:
            text: "Made By YashitaRathi © 2026"

<PasswordAnalyzer>:
    name: "Password Analyzer"

    canvas.before:
        Color:
            rgba: BACKGROUND_COLOR
        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:
        orientation: "vertical"
        padding: dp(40)
        spacing: dp(20)

        Widget:
            size_hint_y: 1
            height: dp(10)

        CardLayout:
            orientation: "vertical"
            padding: dp(25)
            spacing: dp(10)
            size_hint_y: None
            height: min(dp(350) ,Window.width * 0.8)

            TitleLabel:
                text: "Enter Password to Analyze"

            SubtitleLabel:
                text: "This tool evaluates your password using modern security standards, including NIST rules.\nYour password is analyzed locally and never stored or transmitted."
                halign: "center"

            UserText:
                id: user_password
                hint_text: "Enter your password here"
                size_hint: 1, None
                multiline: False
                halign: "center"
                padding: dp(12), dp(14)
            
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: dp(70)
                spacing: dp(10)
                padding: [0, dp(10)]
                pos_hint: {"center_x": 0.5, "center_y": 0.5}

                Widget:
                    size_hint_x: 1

                SecondaryButton:
                    text: "Back"
                    size_hint_x: None
                    width: dp(100)
                    pos_hint: {"center_x": 0.5}
                    on_release: app.root.current = "Welcome Page"

                PrimaryButton:
                    text: "Next"
                    size_hint_x: None
                    width: dp(250)
                    pos_hint: {"center_x": 0.5}
                    on_release: 
                        app.root.get_screen("Personal Info").set_password(user_password.text)
                        app.root.current = "Personal Info"

                Widget:
                    size_hint_x: 1

        Widget:  
            size_hint_y: 1

        FooterLabel:
            text: "Made By YashitaRathi © 2026"

<PersonalInfoPage>:
    name: "Personal Info"

    canvas.before:
        Color:
            rgba: BACKGROUND_COLOR
        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:
        orientation: "vertical"
        padding: dp(40)
        spacing: dp(20)

        Widget:
            size_hint_y: 1
            height: dp(30)

        CardLayout:
            orientation: "vertical"
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            padding: dp(25)
            spacing: dp(15)
            size_hint: (None, None)
            height: min(dp(550), Window.height * 0.85)

            TitleLabel:
                text: "Help Us Check for Guessable Passwords"

            SubtitleLabel:
                text: "Attackers often guess passwords using personal details like names, birthdays, or pets.\nProviding this information helps us detect if your password could be easily guessed.\nThis information is analyzed locally and is NEVER stored."
                halign: "center"

            Widget:
                size_hint_y: None
                height: dp(2)

            ScrollView:
                size_hint_y: None
                height: dp(200) 
                do_scroll_x: False
                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(12)
                    padding: [0, dp(10)]

                    Label:
                        text: "First Name or Nickname (optional)"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: name_input
                        hint_text: "e.g. Nihal"

                    Label:
                        text: "Birth Year (optional)"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: birth_input
                        hint_text: "e.g. 2001"
                        input_filter: "int"

                    Label:
                        text: "Pet's Name (optional)"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: pet_input
                        hint_text: "e.g. Bruno"

                    Label:
                        text: "Any word you commonly use (optional)"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: common_input
                        hint_text: "e.g. coffee"

            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: dp(60)
                spacing: dp(10)
                padding: [0, dp(10)]
                pos_hint: {"center_x": 0.5, "center_y": 0.5}

                Widget:
                    size_hint_x: 1

                SecondaryButton:
                    size_hint_x: None
                    width: dp(100)
                    pos_hint: {"center_x": 0.5}
                    text: "Back"
                    on_release: app.root.current = "Password Analyzer"

                PrimaryButton:
                    size_hint_x: None
                    width: dp(200)
                    pos_hint: {"center_x": 0.5}
                    text: "Analyze Password"
                    on_release: 
                        root.submit_details(skip=False)

                SecondaryButton:
                    size_hint_x: None
                    width: dp(100)
                    pos_hint: {"center_x": 0.5}
                    text: "Skip"
                    on_release: root.submit_details(skip=True)

                Widget:
                    size_hint_x: 1
        Widget:
            size_hint_y: 1
            
        FooterLabel:
            text: "Made By YashitaRathi © 2026"

<OrganizationPolicyChecker>:
    name: "Policy Analyzer"

    canvas.before:
        Color:
            rgba: BACKGROUND_COLOR
        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:
        orientation: "vertical"
        padding: dp(40)
        spacing: dp(20)
        
        Widget:
            size_hint_y: 1
            height: dp(10)

        CardLayout:
            orientation: "vertical"
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            padding: dp(25)
            spacing: dp(15)
            size_hint: (None, None)
            height: min(dp(550), Window.height * 0.85)

            TitleLabel:
                text: "Organization Policy Checker"
            SubtitleLabel:
                text: "Your organization deserves a policy that truly protects.\nUse our tool for a trusted, friendly comparison to the NIST standard, ensuring you move beyond old habits (like forced expirations) toward mandating Multi-Factor Authentication and cutting-edge digital defense."
            SubtitleLabel:
                text: "Enter your organization's current password rules below to compare them against modern NIST security standards."

            ScrollView:
                size_hint_y: None
                height: dp(200) 
                do_scroll_x: False

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(12)
                    padding: [0, dp(10)]

                    Label:
                        text: "Password minimum length?"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: min_length
                        hint_text: "e.g. 8"
                        input_filter: "int"

                    Label:
                        text: "Password maximum length?"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: max_length
                        hint_text: "e.g. 15"
                        input_filter: "int"
                    
                    Label:
                        text: "Max Failed Login Attempts?"
                        color: TEXT_COLOR
                        halign: "left"
                        text_size: self.size
                        valign: 'middle'
                        markup: True

                    UserText:
                        id: login
                        hint_text: "e.g. 5"
                        input_filter: "int"

                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        Label:
                            text: "Require Special Characters/Numbers?"
                            color: TEXT_COLOR
                            halign: "left"
                            text_size: self.size
                            valign: 'middle'
                            markup: True
                        CheckBox:
                            id: requirement
                            size_hint_x: None
                            width: dp(50)
                            color: TEXT_COLOR

                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        Label:
                            text: "Force Password Expiration?"
                            color: TEXT_COLOR
                            halign: "left"
                            text_size: self.size
                            valign: 'middle'
                            markup: True
                        CheckBox:
                            id: expiration
                            size_hint_x: None
                            width: dp(50)
                            color: TEXT_COLOR

                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        Label:
                            text: "Use Common Password Blocklist?"
                            color: TEXT_COLOR
                            halign: "left"
                            text_size: self.size
                            valign: 'middle'
                            markup: True
                        CheckBox:
                            id: blocklist
                            size_hint_x: None
                            width: dp(50)
                            color: TEXT_COLOR

                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        Label:
                            text: "Use Security Questions?"
                            color: TEXT_COLOR
                            halign: "left"
                            text_size: self.size
                            valign: 'middle'
                            markup: True
                        CheckBox:
                            id: security_question
                            size_hint_x: None
                            width: dp(50)
                            color: TEXT_COLOR

                
                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        Label:
                            text: "Allow Long Passphrases?"
                            color: TEXT_COLOR
                            halign: "left"
                            text_size: self.size
                            valign: 'middle'
                            markup: True
                        CheckBox:
                            id: passphrase
                            size_hint_x: None
                            width: dp(50)
                            color: TEXT_COLOR
            
                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        Label:
                            text: "Mandate Multi-Factor Auth (MFA)?"
                            color: TEXT_COLOR
                            halign: "left"
                            text_size: self.size
                            valign: 'middle'
                            markup: True
                        CheckBox:
                            id: mfa
                            size_hint_x: None
                            width: dp(50)
                            color: TEXT_COLOR
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: dp(60)
                spacing: dp(10)
                padding: [0, dp(10)]
                pos_hint: {"center_x": 0.5, "center_y": 0.5}

                Widget:
                    size_hint_x: 1

                SecondaryButton:
                    size_hint_x: None
                    width: dp(100)
                    pos_hint: {"center_x": 0.5}
                    text: "Back"
                    on_release: app.root.current = "Welcome Page"

                PrimaryButton:
                    size_hint_x: None
                    width: dp(250)
                    pos_hint: {"center_x": 0.5}
                    text: "Analyze Policy"
                    on_release: app.analyze_policy()

                Widget:
                    size_hint_x: 1
                
        Widget:
            size_hint_x: 1

        FooterLabel:
            text: "Made By YashitaRathi © 2026"       

<PoliyPasswordPopup@Popup>:
    title: ""
    title_size: 0
    separator_height: 0
    separator_color: 0,0,0,0
    size_hint: 0.9, 0.85
    auto_dismiss: False
    background: ""
    background_color: 1,1,1,0

    BoxLayout:
        orientation: "vertical"
        padding: dp(25)
        spacing: dp(15)

        canvas.before:
            Color:
                rgba: 1,1,1,1
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: CARD_RADIUS
        
        Label:
            text: "Analysis of Organization Password Policy"
            font_name: "assets/Montserrat-SemiBold.ttf"
            font_size: "20sp"
            color: PRIMARY_COLOR
            size_hint_y: None
            height: self.texture_size[1] + dp(10)
            halign: "center"
            valign: "middle"
            text_size: self.width, None

        Label:
            id: rating_label
            text: ""
            font_name: "assets/Montserrat-Medium.ttf"
            font_size: "16sp"
            color: TEXT_COLOR
            size_hint_y: None
            height: self.texture_size[1] + dp(10)
            halign: "center"
            valign: "middle"
            text_size: self.width, None
            markup: True

        Label:
            id: score_label
            text: ""
            font_name: "assets/Montserrat-Medium.ttf"
            font_size: "16sp"
            color: TEXT_COLOR
            size_hint_y: None
            height: self.texture_size[1] + dp(10)
            halign: "center"
            valign: "middle"
            text_size: self.width, None
            markup: True
        
        ScrollView:
            size_hint_y: 1
            do_scroll_x: False
            bar_width: dp(6)

            BoxLayout:
                id: content_box
                orientation: "vertical"
                size_hint_y: None
                size_hint_x: 1
                height: self.minimum_height
                spacing: dp(15)
                padding: 0
                
                Label:
                    id: issues_label
                    text: ""
                    font_name: "assets/Montserrat-Medium.ttf"
                    font_size: "16sp"
                    color: TEXT_COLOR
                    size_hint_y: None
                    height: self.texture_size[1] + dp(10)
                    halign: "left"
                    valign: "top"
                    text_size: self.width, None
                    markup: True

                Label:
                    id: suggestions_label
                    text: ""
                    font_name: "assets/Montserrat-Medium.ttf"
                    font_size: "16sp"
                    color: TEXT_COLOR
                    size_hint_y: None
                    height: self.texture_size[1] + dp(10)
                    halign: "left"
                    valign: "top"
                    text_size: self.width, None
                    markup: True
                
                Label:
                    id: details_label
                    text: ""
                    font_name: "assets/Montserrat-Medium.ttf"
                    font_size: "16sp"
                    color: TEXT_COLOR
                    size_hint_y: None
                    height: self.texture_size[1] + dp(10)
                    halign: "left"
                    valign: "top"
                    text_size: self.width, None
                    markup: True

        PrimaryButton:
            size_hint_y: None
            height: dp(50)
            size_hint_x: None
            width: min(Window.width * 0.5, dp(300))
            pos_hint: {"center_x": 0.5}
            text: "Close"
            on_release: root.dismiss()

<AnalysisResult@Popup>:
    title: ""
    title_size: 0
    separator_height: 0
    separator_color: 0,0,0,0
    size_hint: 0.9, 0.85
    auto_dismiss: False
    background: ""
    background_color: 1,1,1,0

    BoxLayout:
        orientation: "vertical"
        padding: dp(25)
        spacing: dp(15)

        canvas.before:
            Color:
                rgba: 1,1,1,1
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: CARD_RADIUS
        
            
        Label:
            text: "Analysis Result"
            font_name: "assets/Montserrat-SemiBold.ttf"
            font_size: "20sp"
            color: PRIMARY_COLOR
            size_hint_y: None
            height: self.texture_size[1] + dp(10)
            markup: True
            halign: "center"
            text_size: self.width, None

        Label:
            id: strength_label
            text: ""
            font_name: "assets/Montserrat-Medium.ttf"
            font_size: "16sp"
            color: TEXT_COLOR
            size_hint_y: None
            height: self.texture_size[1] + dp(10)
            markup: True
            text_size: self.width, None
            halign: "center"

        Label:
            id: points_label
            text: ""
            font_name: "assets/Montserrat-Medium.ttf"
            font_size: "16sp"
            color: TEXT_COLOR
            size_hint_y: None
            height: self.texture_size[1] + dp(10)
            markup: True
            halign: "center"
            text_size: self.width, None
        
        ScrollView:
            size_hint_y: 1

            BoxLayout:
                id: content_box
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: 15
                padding: 20

                Label:
                    id: issues_label
                    text: ""
                    font_name: "assets/Montserrat-Medium.ttf"
                    font_size: "16sp"
                    color: TEXT_COLOR
                    size_hint_y: None
                    height: self.texture_size[1] + dp(10)
                    markup: True
                    halign: "left"
                    text_size: self.width, None

                Label:
                    id: suggestions_label
                    text: ""
                    font_name: "assets/Montserrat-Medium.ttf"
                    font_size: "16sp"
                    color: TEXT_COLOR
                    size_hint_y: None
                    height: self.texture_size[1] + dp(10)
                    markup: True
                    halign: "left"
                    text_size: self.width, None

        PrimaryButton:
            size_hint_x: None
            width: min(Window.width * 0.5, dp(300))
            pos_hint: {"center_x": 0.5}
            text: "Close"
            on_release: root.dismiss()
                    

